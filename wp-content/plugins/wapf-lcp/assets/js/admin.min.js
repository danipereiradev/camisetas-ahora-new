var WAPF;!function(e){e.isGutenberg=function(){return null!==document.querySelector(".block-editor")},(e.Models||(e.Models={})).Customize=function(){this.type="gallery",this.x=0,this.y=0,this.w=0,this.h=0,this.rotate=0,this.color={default:"#000",rules:[]},this.weight="normal",this.italic=!1,this.caps=!1,this.textMode="default",this.valign="top",this.size={default:16,rules:[]},this.sizeMobile={default:16,rules:[]},this.sizeTablet={default:16,rules:[]},this.sizeXs={default:16,rules:[]},this.align={default:"left",rules:[]},this.font={default:"Arial",rules:[]},this.lineheight={default:"",rules:[],unit:"ul"},this.imgFit="",this.shape="",this.px=0,this.py=0,this.pw=0,this.ph=0}}(WAPF=WAPF||{}),function(c){function u(e){return e?d(e=(e=e.replace("-150x150.",".").replace("-300x300.",".").replace("-100x100.",".").replace("-1024x1024.",".").replace("-768x768.",".").replace("-768x545.",".")).replace(/-\d+x\d+(?=\.(png|jpg|jpeg|gif|PNG|JPG|JPEG|GIF))/,"")):""}function i(){var r=[];return(c.isGutenberg()?jQuery("#woocommerce-product-images ul.product_images > li, .editor-post-featured-image"):jQuery("ul.product_images > li,#postimagediv")).each(function(e,t){var i=jQuery(t).find("img");if(i.length){var t=jQuery(t).data("attachment_id")?jQuery(t).data("attachment_id"):c.isGutenberg()?(t=jQuery(".editor-post-featured-image .hidden")).length&&2===(t=t.attr("id").split("editor-post-featured-image-")).length&&parseInt(t[1].replace("-describedby",""))||0:parseInt(jQuery("[name=_thumbnail_id]").val())||0,a=d(i.attr("src")),s=u(a);if((!s.length||s===a)&&i.attr("srcset"))for(var l=i.attr("srcset").split(","),o=0;o<l.length;o++){var n=l[o].trim().split(" ");if(600<parseInt(n[n.length-1].replace("w",""))){s=d(n[0]);break}}0<t&&s.length&&r.push({url:a,largeUrl:s,id:t})}}),r}function d(e){return e?e.split("?")[0].trim():""}function t(e){var t=this;jQuery.getJSON(wapflcp_config.ajaxUrl,{action:"wapflcp_get_variation_info",id:e},function(e){t.variationIds=e.data.variations,t.attributeIds=e.data.attributes})}function a(e){var t=this;t.fieldIds=[],t.selectFieldIds=[],t.imageFieldIds=[],e.forEach(function(e){"img"===e.type&&t.imageFieldIds.push({id:e.id,label:"Image field #"+e.id,url:d(e.image),largeUrl:u(e.image)}),-1<["date","text","number","textarea","select","file","text-swatch","multi-text-swatch","radio","checkboxes"].indexOf(e.type)&&t.fieldIds.push({type:e.type,id:e.id,label:e.label+" (ID: "+e.id+")"}),-1<["select","color-swatch","radio","multi-color-swatch","image-swatch","multi-image-swatch","text-swatch","multi-text-swatch","checkboxes"].indexOf(e.type)&&t.selectFieldIds.push({id:e.id,label:e.label+" (ID: "+e.id+")",options:e.choices.map(function(e){return{label:e.label,id:e.slug}})})}),t.hasImages=0<t.galleryImages.length||0<t.imageFieldIds.length}function s(a){var s=this,e=(s.$canvasLoader.show(),new Image);e.onload=function(){s.$canvasWrapper.find("img").remove(),jQuery(jQuery(e).css("vertical-align","bottom")).appendTo(s.$canvasWrapper);var i=function(){var e,t,i,a,s=jQuery(".wapfc-canvas");return s.css("width","").css("height",""),e=this.$canvasWrapper.width(),t=this.$canvasWrapper.height(),i=(i=s)[0],a=devicePixelRatio,i.width=e*a,i.height=t*a,i.style.width=e+"px",i.style.height=t+"px",i.getContext("2d").scale(a,a),s[0].getContext("2d").clearRect(0,0,s.width(),s.height()),s}.call(s);s.otherDrawings=[],s.rows.forEach(function(e,t){e.px||(e.px=e.x/100*i.width(),e.py=e.y/100*i.height(),e.pw=e.w/100*i.width(),e.ph=e.h/100*i.height()),e.img!==s.activeCustomization.img||null!==a&&a===t||s.otherDrawings.push(e)}),v(i,s.activeCustomization.px?s.activeCustomization:null,s.otherDrawings),i.trigger("init"),s.$canvasLoader.hide()},e.src=s.activeCustomization.largeUrl}function v(e,t,i){function a(e){s.save();var t,i,a=parseInt(e.rotate);a&&(t=e.px+e.pw/2,i=e.py+e.ph/2,s.translate(t,i),s.rotate(a*Math.PI/180),s.translate(-1*t,-1*i)),s.strokeRect(e.px,e.py,e.pw,e.ph),"oval"===e.shape&&(s.beginPath(),s.ellipse(Math.abs(e.px+e.pw/2),Math.abs(e.py+e.ph/2),Math.abs(e.pw/2),Math.abs(e.ph/2),0,0,2*Math.PI),s.stroke(),s.closePath()),s.restore()}var s=e[0].getContext("2d");s.clearRect(0,0,e[0].width,e[0].height),s.setLineDash([4]),s.shadowColor="rgba(5,153,212,.13)",s.shadowBlur=10,s.strokeStyle="#0599d4",s.lineWidth=2;t&&a(t),i&&i.length&&i.forEach(function(e){s.strokeStyle="rgba(5,153,212,0.35)",a(e)})}(c.Controllers||(c.Controllers={})).CICtrl=function(e){var l=this;!function(){function a(e,t){return e=e.getBoundingClientRect(),{x:t.clientX-e.left,y:t.clientY-e.top}}function m(e,t){return!!t&&(e.x>t.px&&e.x<t.px+t.pw&&e.y>t.py&&e.y<t.py+t.ph)}var g=this;tinybind.formatters.isFileField=function(e,t){for(var i=0;i<g.fieldIds.length;i++){var a=g.fieldIds[i];if(a.id===e&&"file"===a.type)return!t||"not"!==t}return!(!t||"not"!==t)},tinybind.binders.canvas={bind:function(i){var s,l,o=tinybind.adapters[this.observer.key.i],n=this.model,r=this.observer.key.path,c=(i.getContext("2d"),jQuery(i)),u=0,d=!1,h=!1,p=null;c.on("init",function(){p=Object.assign({},g.activeCustomization)}).on("mousedown",function(e){var t=a(i,e);s=t.x,u=t.y,l=!0,!d&&m(t,p)&&(h=!0),e.preventDefault()}).on("mouseup",function(e){var t,i,a=o.get(n,r);h&&(a.px=p.px,a.py=p.py,a.x=+(p.px/c.width()*100).toFixed(2),a.y=+(p.py/c.height()*100).toFixed(2)),d&&0!=p.pw&&0!=p.ph&&(t=s/c.width()*100,i=u/c.height()*100,p.pw<0&&(s-=Math.abs(p.pw),t-=Math.abs(p.pw)/c.width()*100),p.ph<0&&(u-=Math.abs(p.ph),i-=Math.abs(p.ph)/c.height()*100),a.px=s,a.py=u,a.pw=Math.abs(p.pw),a.ph=Math.abs(p.ph),a.x=+t.toFixed(2),a.y=+i.toFixed(2),a.w=+(Math.abs(p.pw)/c.width()*100).toFixed(2),a.h=+(Math.abs(p.ph)/c.height()*100).toFixed(2)),o.set(n,r,a),p=g.activeCustomization,g.onChange(),d=l=h=!1}).on("mousemove",function(e){e=a(i,e);h||m(e,p)?c.css("cursor","move"):c.css("cursor","crosshair"),(l||h)&&(h?(p.px=e.x,p.py=e.y):(p.px=s,p.py=u,d=!0,p.pw=e.x-s,p.ph=e.y-u),v(c,{shape:p.shape,rotate:p.rotate,px:p.px,py:p.py,pw:p.pw,ph:p.ph},g.otherDrawings))})}}}.call(l),this.$canvasWrapper=jQuery(".wapfc-canvas-wrapper"),this.$canvasLoader=jQuery(".wapfc-customizer-loader"),this.$customizer=jQuery(".wapfc-customizer"),this.$selector=jQuery(".wapfc-selector"),this.$productType=jQuery("select#product-type"),this.isVariation=-1<this.$productType.val().indexOf("variable"),this.rows=[],this.fieldIds=[],this.selectFieldIds=[],this.variationIds=[],this.attributeIds=[],this.imageFieldIds=[],this.selectedImg=null,this.json="",this.galleryImages=i(),this.hasImages=!1,this.step=1,this.activeCustomization=null,this.otherDrawings=[],this.activeValueSelector=this.activeValueSelectorMobile=this.activeValueSelectorTablet=null,jQuery("#product_image_gallery").on("change",function(){l.galleryImages=i(),l.hasImages=l.galleryImages.length||l.imageFieldIds.length;var t=[];l.rows.forEach(function(e){c.Api.Collections.findFirst(l.galleryImages,"id",e.img,"==")&&t.push(e)}),l.rows=t,l.onChange()}),c.Main.bindings.FieldListCtrl&&a.call(l,c.Main.bindings.FieldListCtrl.models.fields),jQuery(document).on("wapf/fields/change",function(e,t){a.call(l,t)}),jQuery(document).on("wapf/media_selected",function(e){a.call(l,c.Main.bindings.FieldListCtrl.models.fields),l.rows.forEach(function(e){c.Api.Collections.findFirst(l.imageFieldIds,"id",e.img,"==")&&(e.url=d(jQuery('[data-field-id="'+e.img+'"] .wapf-media-selector input[type="hidden"]').val()),e.largeUrl=d(jQuery('[data-field-id="'+e.img+'"] .wapf-media-selector input[type="hidden"]').val()))})}),jQuery("#woocommerce-product-data").on("woocommerce_variations_removed woocommerce_variations_added",function(){t.call(l,woocommerce_admin_meta_boxes.post_id)}),this.isVariation&&t.call(l,woocommerce_admin_meta_boxes.post_id),(e.data("rows")||[]).forEach(function(e){var t=new c.Models.Customize,t=Object.assign(t,e),e=(!e.sizeXs&&e.sizeMobile&&(t.sizeXs.default=e.sizeMobile.default,t.sizeXs.rules=e.sizeMobile.rules),e.lineheight.unit||(t.lineheight.unit="px"),c.Api.Collections.findFirst(e.type&&"gallery"!==e.type?l.imageFieldIds:l.galleryImages,"id",e.img));e&&(t.url=e.url,t.largeUrl=e.largeUrl,l.rows.push(t))}),this.setSelectedGalleryImage=function(e,t){var i=null,e=jQuery(e.currentTarget);e.is("select")?(""+e.val()).length&&(i=l.imageFieldIds[e.val()],l.activeCustomization.type="img"):(i=l.galleryImages[t.$index],l.activeCustomization.type="gallery"),l.activeCustomization.img=i?i.id:null,l.activeCustomization.url=i?i.url:null,l.activeCustomization.largeUrl=i?i.largeUrl:null},this.addNew=function(e,t){jQuery(".select-wapfc-img").val(""),l.step=1;var i=(l.galleryImages.length?l.galleryImages:l.imageFieldIds)[0],a=new c.Models.Customize;a.img=i.id,a.url=i.url,a.largeUrl=i.largeUrl,a.field=l.fieldIds[0].id,l.activeCustomization=a,l.rows.push(a),l.onChange(),l.$customizer.show(),jQuery(".wapfc-select-img > div:first-child").trigger("click")},this.nextStep=function(e,t){e.preventDefault(),l.step=l.step+1,3===l.step&&s.call(l,null)},this.deleteCustomizerRow=function(e,t){e.preventDefault(),l.rows.splice(t.$index,1),l.onChange()},this.openCustomizerOnFinalStep=function(e,t){e.preventDefault(),l.activeCustomization=l.rows[t.$index],l.step=3,l.$customizer.show(),s.call(l,t.$index)},this.maybeSetSizeRules=function(e,t){e=jQuery(e.currentTarget);"size"!==l.activeValueSelector.for||e.hasClass("wapf--active")||(l.mobileRule=l.activeCustomization.sizeMobile.rules[t.$index],l.tabletRule=l.activeCustomization.sizeTablet.rules[t.$index],l.xsRule=l.activeCustomization.sizeXs.rules[t.$index])},this.openDynamicValue=function(e,t){e.preventDefault();var e=jQuery(e.currentTarget).data("for"),i={for:e,renderAs:"align"===e?"select":"size"===e?"size":"text",customize:l.activeCustomization[e]};"align"==e&&(i.options=[{label:"Left",value:"left"},{label:"Center",value:"center"},{label:"Right",value:"right"}]),i.customize.rules||(i.customize.rules=[]),l.activeValueSelector=i,"size"===e?(l.activeValueSelectorTablet=l.activeCustomization.sizeTablet,l.activeValueSelectorMobile=l.activeCustomization.sizeMobile,l.activeValueSelectorXs=l.activeCustomization.sizeXs,l.activeValueSelectorMobile.rules||(l.activeValueSelectorMobile.rules=[]),l.activeValueSelectorTablet.rules||(l.activeValueSelectorTablet.rules=[]),l.activeValueSelectorXs.rules||(l.activeValueSelectorXs.rules=[])):l.activeValueSelectorTablet=l.activeValueSelectorMobile=l.activeValueSelectorXs=null,l.$selector.show()},this.addValueRule=function(e,t){e.preventDefault(),l.activeValueSelector.customize.rules.push({type:"field",id:""}),"size"===l.activeValueSelector.for&&(l.activeCustomization.sizeMobile.rules.push({type:"field",id:""}),l.activeCustomization.sizeTablet.rules.push({type:"field",id:""}),l.activeCustomization.sizeXs.rules.push({type:"field",id:""}))},this.deleteValueRule=function(e,t){e.preventDefault(),l.activeValueSelector.customize.rules.splice(t.$index,1),"size"===l.activeValueSelector.for&&(l.activeCustomization.sizeMobile.rules.splice(t.$index,1),l.activeCustomization.sizeTablet.rules.splice(t.$index,1),l.activeCustomization.sizeXs.rules.splice(t.$index,1)),l.onChange()},this.onMetaChange=function(e,t){var i,a,s;"size"===l.activeValueSelector.for&&(i=l.activeValueSelector.customize.rules[t.$index],a=l.activeCustomization.sizeMobile.rules[t.$index],s=l.activeCustomization.sizeTablet.rules[t.$index],s=l.activeCustomization.sizeXs.rules[t.$index],a.meta=i.meta,s.meta=i.meta),l.onChange()},this.onFieldChange=function(e,t){l.activeSelectFieldOptions=[];var i,a=l.activeValueSelector.customize.rules[t.$index],s=c.Api.Collections.findFirst(l.selectFieldIds,"id",a.id);l.activeSelectFieldOptions=s.options,l.activeSelectFieldOptions.length&&(a.meta=l.activeSelectFieldOptions[0].id,"size"===l.activeValueSelector.for&&(s=l.activeCustomization.sizeMobile.rules[t.$index],i=l.activeCustomization.sizeTablet.rules[t.$index],t=l.activeCustomization.sizeXs.rules[t.$index],s.meta=l.activeSelectFieldOptions[0].id,i.meta=l.activeSelectFieldOptions[0].id,t.meta=l.activeSelectFieldOptions[0].id,s.id=a.id,i.id=a.id,t.id=a.id)),l.onChange()},this.redraw=function(e,t){v(l.$canvasWrapper.find("canvas"),l.activeCustomization,l.otherDrawings),l.onChange()},this.redrawFromNumber=function(e,t){var i=l.$canvasWrapper.find("canvas");i.length&&(l.activeCustomization.w=+(Math.abs(l.activeCustomization.pw)/i.width()*100).toFixed(2),l.activeCustomization.h=+(Math.abs(l.activeCustomization.ph)/i.height()*100).toFixed(2),l.activeCustomization.x=+(l.activeCustomization.px/i.width()*100).toFixed(2),l.activeCustomization.y=+(l.activeCustomization.py/i.height()*100).toFixed(2),l.redraw())},this.onShapeChange=function(){l.redraw(),l.onChange()},this.onChange=function(){var i=[];l.rows.forEach(function(e){var t=Object.assign({},e);["px","py","pw","ph","largeUrl","url"].forEach(function(e){delete t[e]}),i.push(t)}),l.json=JSON.stringify(i)},this.onChange(),document.addEventListener("wapf/export",function(e){var t=jQuery("input[name=wapflcp_rows]").val();e.detail.export.lcp=t?JSON.parse(t):[]}),document.addEventListener("wapf/import",function(e){e.detail.import&&e.detail.import.lcp&&(l.rows=e.detail.import.lcp,l.onChange())})}}(WAPF=WAPF||{}),document.addEventListener("DOMContentLoaded",function(){WAPF.isGutenberg()?new MutationObserver((e,t)=>{for(var i of e)if("childList"===i.type)if(document.querySelector(".editor-post-featured-image__preview-image")){t.disconnect();i=jQuery('[rv-controller="CICtrl"]');WAPF.Main.bindings.CICtrl=tinybind.bind(i[0],new WAPF.Controllers.CICtrl(i));break}}).observe(document.body,{childList:!0,subtree:!0}):setTimeout(function(){var e=jQuery('[rv-controller="CICtrl"]');WAPF.Main.bindings.CICtrl=tinybind.bind(e[0],new WAPF.Controllers.CICtrl(e))},100)});