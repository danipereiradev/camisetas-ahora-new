!function(w){function l(e,t,i){t=parseFloat(t),i=parseFloat(i);return{x:e.x/100*t,y:e.y/100*i,w:e.w/100*t,h:e.h/100*i}}var y={cache:{fonts:[],textQueue:[]},screenType:"desktop",getSettingValue:function(e,t){for(var i=0;i<e.rules.length;i++){var n=e.rules[i];switch(n.type){case"field":var a=t.find('[data-field-id="'+n.id+'"]');if(a.closest(".wapf-field-container").hasClass("wapf-hide"))break;if(WAPF.Util.getFieldValue(a,!0)===n.meta)return n.value;break;case"variation":if(WAPF.Util.currentVariationId(t)==n.id)return n.value;break;case"attribute":var a=n.id.split("|")[0],o=n.id.split("|")[1];if(t.find("select#"+a).val()===o)return n.value}}return e.default},initCanvas:function(e,t,i,n){var a,o,l,r,c,s,f,d,p,g,u="img"===t?e.find(".wapf-img-canvas-wrap"):e,h=w('<div class="lcp-wrap">'),m=w('<div class="lcp-inner lcp-content">'),i=(h.append(m),{element:e,canvasWrapper:h,$inner:m,$parent:i}),v=("gallery"===t&&"function"==typeof w.fn.zoom&&(wc_single_product_params.zoom_enabled||lcpConfig.customZoom)&&(a=w('<div class="lcp-inner lcp-content-zoom" style="opacity: 0">'),h.append(a),d=null,v=u.find("[data-large_image_height]"),p=v.data("large_image_width"),g=v.data("large_image_height"),i.hasZoom=!0,i.zoomRatio=parseFloat(p)/u.width(),i.largeWidth=parseFloat(p),i.largeHeight=parseFloat(g),i.$innerZoom=a,u.on("mouseenter",function(e){r=u.width(),c=u.height(),o=u.width(),l=u.height(),f=(p-o)/r,d=(g-l)/c,s=h.offset(),m.css("opacity",0),a.css("opacity",1)}).on("mousemove",function(e){var t=e.pageX-s.left,e=e.pageY-s.top,e=Math.max(Math.min(e,c),0),t=Math.max(Math.min(t,r),0);a.css("left",t*-d+"px"),a.css("top",e*-f+"px")}).on("mouseleave",function(e){m.css("opacity",1),a.css("opacity",0)})),"img"===t?e.attr("for"):e.data("wapf-att-id")),e=(y.cache[v]||(y.cache[v]=i),t&&"img"===t?u.css("position","relative").prepend(h):h.prependTo(u),null),v=u.find(".wapf-layer-base");!(e=v.length?v.find("img"):u.find("img").first()).length||e[0].complete?n&&n():(e[0].loading="auto",e.on("load",function(){x.run(),n&&n()}))},initFields:function(t,n,l,r,c,s){for(var e=n.length;e--;){var i=t.find('[data-field-id="'+n[e].field+'"]');i.length?(n[e].$field=i,n[e].type=WAPF.Util.getFieldType(i)):n.splice(e,1)}n.forEach(function(a){function o(e){jQuery(document).trigger("lcp/before_draw",[a,y.cache[a.img]]);var i=!1;"img"===l&&r.hasClass("wapf-hide")||(y.clearCanvas(a.img),n.forEach(function(e){var t;e.$field.closest(".wapf-field-container").hasClass("wapf-hide")||("file"!==e.type?(t=WAPF.Util.getFieldValue(e.$field,!1),(t=Array.isArray(t)?t.join(", "):t)&&(t=(""+t).trim()).length&&(t=y.prepTextToCanvas(t,e))&&x.add(t)):e.file&&(y.addImageToCanvas(e.file,e),i=!0))}),x.canRun()&&(x.run(),i=!0),i&&void 0!==e&&-1<e&&(s.data("flexslider")?s.data("flexslider").flexAnimate(e):s.find(".woocommerce-product-gallery__wrapper").data("flickity")?s.find(".woocommerce-product-gallery__wrapper").data("flickity").select(e):t.find(".flex-control-nav li:eq("+e+") img").trigger("click"),document.dispatchEvent(new CustomEvent("lcp/auto_scroll_to",{detail:{scrollIndex:e,gallery:s[0]}}))))}"file"===a.type?(jQuery(document).on("wapf/file_uploaded",function(e,t){var i,n;a.field===t.fieldId&&(2e6<t.file.size?((i=new Image).onload=function(){o(c)},(a.file=i).src=t.response[0].file):((n=new FileReader).onloadend=()=>{var e=new Image;e.onload=function(){o(c)},e.src=n.result,a.file=e},n.readAsDataURL(t.file.transformedFile||t.file)))}),jQuery(document).on("wapf/file_deleted",function(e,t){t.fieldId===a.field&&(a.file=null,o())})):a.$field.on("change keyup",function(){o(c)}).trigger("change"),["color","font","align","size"].forEach(function(e){a[e]&&a[e].rules.length&&a[e].rules.forEach(function(e){"field"===e.type&&t.find('[data-field-id="'+e.id+'"]').off("change keyup",o).on("change",function(){o(c)})})}),jQuery("table.variations select").on("change",o),jQuery(document).on("wapf/dependencies",function(){x.cancelAll(),setTimeout(o,1)})}),n.forEach(function(e){function t(){r!==l.outerWidth()?(n(),l.remove()):0<a?(setTimeout(t,60),a-=60):l.remove()}var i,n,a,o,l,r;"file"!==e.type&&(i=e.font.default||"Arial",n=function(){e.$field.trigger("change")},a=1e3,o="-9999px",l=w("<span>"+Array(15).join("wi")+"</span>").css({position:"absolute",top:o,left:o,visibility:"hidden",fontFamily:i+", Courier New",fontSize:"250px"}),w("body").append(l),r=l.outerWidth(),t())})},init:function(){function e(){var e=jQuery(window).width();y.screenType=e<576?"mobile-portrait":e<768?"mobile":e<992?"tablet":"large"}addEventListener("resize",e),addEventListener("load",e),e(),w(".wapf-product-totals").each(function(e,t){var a,o,i,l,r,c,t=w(t),n=(y.cache.fonts=y.cache.fonts.concat(t.data("fonts")||[]),t.data("customizer"));n&&(a=t.closest("div.product"),o=(a=a.length?a:w("body")).find(".woocommerce-product-gallery"),i="function"==typeof w.fn.flexslider&&1<o.find(".woocommerce-product-gallery__image").length,l=1==t.data("lcpScroll"),r=[],n.forEach(function(e){r[e.img]?r[e.img].push(e):r[e.img]=[e]}),c=function(e){e.find("[data-wapf-att-id]").each(function(e,t){var i=w(t),t=i.data("wapf-att-id"),n=r[t]||[];n.length&&y.initCanvas(i,"gallery",a,function(){y.initFields(a,n,"gallery",i,l?e:-1,o)})})},i?w(document).on("wc-product-gallery-before-init",function(e,t,i){var n=w(t),a=wc_single_product_params.flexslider&&wc_single_product_params.flexslider.start?wc_single_product_params.flexslider.start:function(){};wc_single_product_params.flexslider.start=function(){a(),c(n),n.css("opacity",1)}}):c(o),Object.keys(r).forEach(function(e){var t,i=w(".wapf-field-img[for="+e+"]");i.length&&(i.find("img").wrap('<div class="wapf-img-canvas-wrap" style="display:inline-block">'),t=r[e],y.initCanvas(i,"img",a,function(){y.initFields(a,t,"img",i,-1)}))}))})},clearCanvas:function(e){e=y.cache[e];e&&(e.$inner.html(""),e.hasZoom&&e.$innerZoom.html(""))},addImageToCanvas:function(n,a){var e,o=y.cache[a.img];o&&(e=function(e,t=!1){var i=w('<div style="overflow:hidden;position:absolute;padding:0;margin:0;box-sizing: border-box;" class="lcp-img"></div>');i[0].style.top=e.y+"px",i[0].style.left=e.x+"px",i[0].style.width=e.w+"px",i[0].style.height=e.h+"px",0!=a.rotate&&(i[0].style.transform="rotate("+a.rotate+"deg)"),w(document).trigger("lcp/before_drawing_image",[n,o,e,t,a,i[0]]),i.html(n.cloneNode(!0)),o[t?"$innerZoom":"$inner"].append(i),w(document).trigger("lcp/after_drawing_image",[n,o,e,t,a,i[0]])},a.imgFit&&("scale"===a.imgFit?n.classList.add("scale"):"cover"===a.imgFit&&n.classList.add("cover")),"oval"===a.shape&&n.style.setProperty("border-radius","50%","important"),e(l(a,o.canvasWrapper[0].offsetWidth,o.canvasWrapper[0].offsetHeight)),o.hasZoom&&e(l(a,o.largeWidth,o.largeHeight),!0))},getFont:function(e){for(var t=0;t<y.cache.fonts.length;t++)if(e===y.cache.fonts[t].name)return y.cache.fonts[t];return null},getFontSize:function(i,n){function e(e,t){return i[e]||t&&i[t]?parseInt(y.getSettingValue(i[e],n)):i.size?parseInt(y.getSettingValue(i.size,n)):16}switch(this.screenType){case"mobile":return e("sizeMobile");case"tablet":return e("sizeTablet");case"mobile-portrait":return e("sizeXs");default:return e("size")}},prepTextToCanvas:function(e,t){var i=y.cache[t.img];if(!i)return null;e=(e=t.caps?e.toUpperCase():e).trim(),-1===["single","scaledown"].indexOf(t.textMode)&&(e=null==(o=e)?"":(o+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br/>$2"));var n,a,o="normal";return t.lineheight&&t.lineheight.default&&((n=y.getSettingValue(t.lineheight,i.$parent))&&(a=t.lineheight.unit&&"ul"===t.lineheight.unit?"":"px",o=(""+n).replace(",",".")+a)),{cache:i,field:t,color:y.getSettingValue(t.color,i.$parent),align:t.align?y.getSettingValue(t.align,i.$parent):"left",font:y.getSettingValue(t.font,i.$parent),fontSize:y.getFontSize(t,i.$parent),fontWeight:t.weight,italic:t.italic,textMode:t.textMode,valign:t.valign,lineheight:o,text:e,rotate:t.rotate}},addTextToCanvas:function(e){e.length&&(e.forEach(function(e){x.add(e)}),x.run())}},x={preps:[],add:function(e){this.preps.push(e)},cancelAll:function(){this.preps=[],this.isRunning=!1},canRun:function(){return 0<this.preps.length},isRunning:!1,run:function(e){var t,i,n,a=this;a.canRun()?a.isRunning&&!e||(a.isRunning=!0,t=function(s){function e(e,t=!1){var i=document.createElement("div"),n=(i.classList.add("lcp-text"),{margin:0,padding:0,boxSizing:"border-box",display:"flex",position:"absolute",textAlign:s.align,fontFamily:s.font,color:s.color,fontWeight:s.fontWeight||"normal",fontStyle:s.italic?"italic":"",alignItems:"top"===s.valign?"flex-start":s.valign,lineHeight:s.lineheight||"normal",whiteSpace:"normal",top:e.y+"px",left:e.x+"px",width:e.w+"px",height:e.h+"px",overflow:"visible"});for(const c in n)i.style[c]=n[c];if(i.dataset.fontSize=s.fontSize,t&&(i.dataset.fontSize=Math.floor(s.fontSize*s.cache.zoomRatio)),i.style.fontSize=i.dataset.fontSize+"px",s.lineheight&&t&&t&&(i.style.lineheight=Math.floor(s.lineheight*s.cache.zoomRatio)+"px"),s.textMode&&-1<["single","scaledown","multiscalex"].indexOf(s.textMode)&&(i.style.whiteSpace="nowrap"),0!=s.rotate&&(i.style.transform="rotate("+s.rotate+"deg)",i.style.transformOrigin="center center"),i.innerHTML='<div style="width:100%;">'+s.text+"</div>",w(document).trigger("livecontent/before_drawing_text",[s,e,t,i]),s.cache[t?"$innerZoom":"$inner"].append(i),"scaledown"===s.textMode)for(var a=0,o=i.scrollWidth;a<30&&o>i.offsetWidth;)a++,i.dataset.fontSize=i.dataset.fontSize*(e.w/(o+1)),i.style.fontSize=i.dataset.fontSize+"px",o=i.scrollWidth;if("multiscalex"===s.textMode)for(var a=0,l=i.scrollWidth>i.offsetWidth;a<30&&l;)a++,i.dataset.fontSize=i.dataset.fontSize*(e.w/(i.scrollWidth+1)),i.style.fontSize=i.dataset.fontSize+"px",l=i.scrollWidth>i.offsetWidth;if("multiscaley"===s.textMode)for(var a=0,r=i.scrollHeight>i.offsetHeight;a<30&&r;)a++,i.dataset.fontSize=i.dataset.fontSize*(e.h/(i.scrollHeight+1)),i.style.fontSize=i.dataset.fontSize+"px",r=i.scrollHeight>i.offsetHeight}e(l(s.field,s.cache.canvasWrapper[0].offsetWidth,s.cache.canvasWrapper[0].offsetHeight),!1),s.cache.hasZoom&&e(l(s.field,s.cache.largeWidth,s.cache.largeHeight),!0)},i=a.preps[0],(n=y.getFont(i.font))&&!n.loaded?new FontFace(n.name,"url("+n.url+")").load().then(function(e){n.loaded=!0,document.fonts.add(e),a.preps.length&&(t(i),a.preps.shift(),a.run(!0))}):a.preps.length&&(t(i),a.preps.shift(),a.run(!0))):this.isRunning=!1}};(wapfConfigurator=y).init()}(jQuery);